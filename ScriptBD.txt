CREATE TABLE ROL(
cod_rol int PRIMARY KEY,
nom_rol varchar(50)
);

CREATE TABLE USUARIO(
cod_usuario int PRIMARY KEY,
username_usuario varchar(50),
password_usuario varchar(50),
cod_rol int,
FOREIGN KEY (cod_rol) REFERENCES ROL(cod_rol)
);

CREATE TABLE TRABAJADOR(
codigo_trabajador int,
nombre_trabajador varchar(50),
correo_trabajador varchar(50),
cod_usuario int,
img_trabajador longblob,
FOREIGN KEY (cod_usuario) REFERENCES usuario(cod_usuario),
PRIMARY KEY(codigo_trabajador, cod_usuario)
);

CREATE TABLE PRODUCTO(
cod_producto int primary key,
nom_producto varchar(50),
vl_unitario_producto int,
iva_producto double
);

CREATE TABLE INSUMO(
cod_insumo int primary key,
nom_insumo varchar(50),
valor_insumo int,
iva_insumo double
);

CREATE TABLE INV_PRODUCTO(
cod_inv_producto int,
cod_producto int,
cantidad int,
fecha date,
primary key(cod_inv_producto, cod_producto),
FOREIGN KEY (cod_producto) REFERENCES PRODUCTO(cod_producto)
);

CREATE TABLE INV_INSUMO(
cod_inv_insumo int,
cod_insumo int,
cantidad int,
fecha date,
primary key(cod_inv_insumo, cod_insumo),
FOREIGN KEY (cod_insumo) REFERENCES INSUMO(cod_insumo)
);

ALTER TABLE `inv_insumo` CHANGE `cod_inv_insumo` `cod_inv_insumo` INT(11) NOT NULL AUTO_INCREMENT;

INSERT INTO ROL VALUES (1,'GERENTE');
INSERT INTO ROL VALUES (2, 'INVENTARIO');
INSERT INTO ROL VALUES (3, 'PRODUCCION');
INSERT INTO ROL VALUES (4, 'VENTAS');
INSERT INTO ROL VALUES (5, 'FINANZAS');

INSERT INTO USUARIO VALUES(1,'admin','25xN9KMCwh/SU',1);
INSERT INTO USUARIO VALUES(2,'inventario','25xN9KMCwh/SU',2);
INSERT INTO USUARIO VALUES(3,'produccion','25xN9KMCwh/SU',3);
INSERT INTO USUARIO VALUES(4,'ventas','25xN9KMCwh/SU',4);
INSERT INTO USUARIO VALUES(5,'finanzas','25xN9KMCwh/SU',5);

INSERT INTO INSUMO VALUES(1,'Agujeta',15, 0.19);
INSERT INTO INSUMO VALUES(2,'Cuero',38, 0.19);
INSERT INTO INSUMO VALUES(3,'Solapa',22, 0.19);
INSERT INTO INSUMO VALUES(4,'Plastico', 5, 0.19);
INSERT INTO producto VALUES(1,'Zapatos de Cuero',15000, 0.19);
INSERT INTO producto VALUES(2,'Botas de Lluvia',38000, 0.19);
INSERT INTO producto VALUES(3,'Zapatos Colegial',22000, 0.19);
INSERT INTO producto VALUES(4,'Zapatillas Deportiva', 5000, 0.19);

CREATE TABLE M_PAGO(
cod_m_pago INT PRIMARY KEY,
nom_m_pago VARCHAR(30)
);

INSERT INTO M_PAGO VALUES(1,'Efectivo');
INSERT INTO M_PAGO VALUES(2,'Credito');
INSERT INTO M_PAGO VALUES(3,'Sodexo');

CREATE TABLE FACTURA(
cod_factura INT PRIMARY KEY AUTO INCREMENT,
nom_cli_factura VARCHAR(50),
cc_nit_factura VARCHAR(20),
dir_factura VARCHAR(50),
tel_factura VARCHAR(20),
cod_m_pago INT,
subtotal DOUBLE,
iva DOUBLE,
total DOUBLE,
fecha date,
FOREIGN KEY (cod_m_pago) REFERENCES M_PAGO(cod_m_pago)
);

CREATE TABLE ITEM_FACTURA(
cod_factura int,
cod_producto int,
cantidad_item int,
FOREIGN KEY (cod_factura) REFERENCES FACTURA(cod_factura),
FOREIGN KEY (cod_producto) REFERENCES PRODUCTO(cod_producto),
PRIMARY KEY (cod_factura, cod_producto)
);

CREATE VIEW AS
SELECT `cod_factura`,`nom_cli_factura`,`cc_nit_factura`,`dir_factura`,`tel_factura`,`nom_m_pago`,`subtotal`,`iva`,`total`,`fecha`
FROM factura, m_pago
WHERE factura.cod_m_pago = m_pago.cod_m_pago;

CREATE VIEW v_item_factura AS
SELECT cod_factura codigo, nom_producto producto, cantidad_item cantidad, vl_unitario_producto costo, (cantidad_item*vl_unitario_producto) total
FROM item_factura, producto
WHERE item_factura.cod_producto = producto.cod_producto
ORDER BY cod_factura asc;


